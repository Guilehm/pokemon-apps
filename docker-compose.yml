version: "3.8"


services:
  fastapp:
    build: ./fastapp
    image: fastapp
    container_name: fastapp
    command: bash -c "gunicorn -w 4 -p 80 -b 0.0.0.0:80 -k uvicorn.workers.UvicornWorker main:app"
    volumes:
      - ./fastapp:/code
    ports:
      - 8000:80

  dollop:
    build: ./dollop
    image: dollop
    container_name: dollop
    command: yarn dev
    volumes:
      - ./dollop:/usr/src/app
      - node-modules-dollop:/usr/src/app/node_modules
    ports:
      - 3000:80
    environment:
      PORT: 80

  nginx:
    image: nginx:1.19
    container_name: spoon-proxy
    volumes:
      - ./proxy/nginx.conf:/etc/nginx/nginx.conf
      - ./proxy/default.conf:/etc/nginx/conf.d/default.conf
    ports:
      - 80:80
    links:
      - fastapp:fastapp
      - dollop:dollop

volumes:
  node-modules-dollop:
